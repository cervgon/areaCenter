function hideAnalysisData(){$("#xg").css("display","none"),$("#yg").css("display","none"),$("#left").css("display","none"),$("#right").css("display","none"),$("#top").css("display","none"),$("#bottom").css("display","none"),$("#area").css("display","none")}function showAnalysisData(){$("#left").fadeIn(200),$("#right").fadeIn(200),$("#top").fadeIn(200),$("#bottom").fadeIn(200),setTimeout(function(){$("#area").fadeIn(200)},200),setTimeout(function(){$("#xg").fadeIn(200),$("#yg").fadeIn(200)},400)}function uploadImage(){imgSrc=null,$("#uploadImage").on("change",function(){var a=this.files?this.files:[];if(a.length&&window.FileReader&&/^image/.test(a[0].type)){var b=new FileReader;b.readAsDataURL(a[0]),b.onloadend=function(){imgSrc=this.result,generate(imgSrc)}}})}function multiple(a,b){return rest=a%b,0===rest}function generate(a){hideAnalysisData();var b=!1;imageData=[],img=new Image,null===a||void 0===a?img.src=$("#previewImg").attr("src"):img.src=a,img.onload=function(){document.createElement("canvas");this.canvas||(this.canvas=$("<canvas />")[0],this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.getContext("2d").drawImage(this,0,0,this.width,this.height)),width=Math.floor(this.canvas.width)-1,height=Math.floor(this.canvas.height)-1;var f;f=filter?105-filter:5,step=1;var g=width*height;g>95e3&&(step=2),g>13e5&&(step=3),g>26e5&&(step=5),g>54e5&&(step=8);var h=0,i=0,j=height,k=0,l=width,m=0,n=0,o=0;yg=0,xg=0;var r=0,t=0,u=0,v=Math.floor((width+1)/step)*Math.floor((height+1)/step),w=new Date;document.getElementById("outputTime");pixelData=null;for(var y=0;y<=width;y+=step)for(var z=0;z<=height;z+=step){pixelData=this.canvas.getContext("2d").getImageData(y,z,1,1).data,n=Math.floor((299*pixelData[0]+587*pixelData[1]+114*pixelData[2])/2550),m=100-n;var A=pixelData[3];if(m=Math.floor(m*A/255),h++,imageData[h]=m,m>f&&A>0&&(r++,yg+=z*m,xg+=y*m,o+=m,i<=z&&i<=height&&(i=z),j>=z&&(j=z),l>=y&&(l=y),k<=y&&k<=width&&(k=y),t+=A/255),h>=v){showAnalysisData(),ygFinal=Math.floor(yg/o),ygFinal||(ygFinal=Math.floor(height/2)),xgFinal=Math.floor(xg/o),xgFinal||(xgFinal=Math.floor(width/2));var B=(width+1)/step*((height+1)/step);u=Math.floor(1e4*t/B)/100,k+=step,k+2*step>=width&&(k=width),i+=step,i+2*step>=height&&(i=height),$("#output").html("xg: "+xgFinal+"   yg: "+ygFinal+"<br><br>downPos: "+i+"   upPos: "+j+"<br><br>leftPos: "+l+"   rightPos: "+k+"<br><br>counter: "+h+"   counterPix: "+r+"<br><br>Area:"+u+"%"),$("#previewImg").attr("src",a);var C=1,D=$(".container").width();width>D&&(C=D/width,$("#previewImg").width(width*C)),$("#xg").width(xgFinal*C),xgFinal>36&&ygFinal>36&&($("#xg").html("<div><span>xg</span></div>"),$("#yg").html("<div><span>yg</span></div>")),$("#yg").height(ygFinal*C);var E=l*C-1;E<0&&(E=0),$("#left").width(E),$("#right").width(k*C),$("#top").height(j*C-1);var F=i*C-1;return F<0&&(F=0),$("#bottom").height(F),$("#area").height(i*C-j*C),$("#area").width(k*C-l*C),$("#area").css("top",j*C),$("#area").css("left",l*C),b=!0,!1}if(2e3==h){var G=getEta(2e3,w,g,step);G[1]}if(h>2e3&&multiple(h,2e3)){var G=getEta(h,w,g,step);G[1]}}}}function areaMomentOfInertia(){var a=0;$("#areaMomentOfInertiaPre").html("areaMomentOfInertia: "+a+xgFinal)}function showVal(a){clearTimeout(showValTimeOut),showValTimeOut=setTimeout(function(){generate(),a=Number(a),chromeApp?storage.set({filter:a}):localStorage.setItem("filter",a)},1e3)}var imgSrc,imageData=[],filter=70,chromeApp=!1,storage,getEta=function(a,b,c,d){var e=new Date,f=e-b,g=c/d/d*(e-b)/a,h=Math.floor(g-f);return[g,h]},showValTimeOut;$(document).ready(function(){var a=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);a&&void 0!==chrome.storage&&(storage=chrome.storage.local,chromeApp=!0);uploadImage(),hideAnalysisData(),chromeApp?storage.get("filter",function(a){filter=a.filter,console.log("filter",filter),filter||(filter=70),$("#filter input[type=range]").val(filter),showVal(filter)}):(localStorage&&(filter=localStorage.getItem("filter")),filter||(filter=70),$("#filter input[type=range]").val(filter),showVal(filter)),$("#range").on("change",function(){filter=$(this).val(),showVal(filter)})});
